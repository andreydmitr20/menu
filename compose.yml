# For other django project you should change
# all occurrence 'menu' in:
# 1. compose.yml (this file)
# 2.1 django/Dockerfile
# 2.2 django/uwsgi.ini
# 3.1 nginx/Dockerfile
# 3.2 nginx/nginx.conf
# 3.3 nginx/django.nginx.conf
version: "3.9"
services:
  nginx:
    build: ./nginx/
    restart: always
    volumes:
      - uwsgi_data:/tmp/uwsgi/
      - web_static:/code/static/:ro
      - ./www/:/code/www:ro
    ports:
      #- "80:80"
      - "80:80"
    depends_on:
      - django

  django:
    build: ./django/
    restart: always
    command: >
      sh -c "python3 manage.py collectstatic --noinput
      && uwsgi --ini uwsgi.ini"
    volumes:
      - ./env/:/code/env:ro
      - uwsgi_data:/tmp/uwsgi/
      - web_static:/code/static/

  jenkins:
    image: jenkins_and_docker:lts
    restart: unless-stopped
    privileged: true
    user: root
    ports:
      - "8080:8080"
    container_name: jenkins
    volumes:
      - ~/jenkins:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker

volumes:
  uwsgi_data:
  web_static:
